---
setup:

  - do:
      indices.create:
        index: test
        body:
          settings:
            relocate_fields_if_possible: true
            refresh_interval: -1

---
"basic":
  - do:
      index:
          index:  test
          type:   doc
          id:     1
          body:
              foo: bar
              i:   1
              f:   1.2
              d:   "2018-01-01T12:33:55"

  - do:
      get:
          index:  test
          type:   doc
          id:     1
  - match: { _source.foo: [bar] }
  - match: { _source.i:   [1] }
  - match: { _source.f:   [1.2000000476837158] }
  - match: { _source.d:   ["2018-01-01T12:33:55.000Z"] }

  - do:
      update:
          index:   test
          type:    doc
          id:      1
          refresh: true
          body:
            doc:
                foo: baz
                i:   2
  - match: { _index:   test }
  - match: { _type:    doc }
  - match: { _id:      "1" }
  - match: { _version: 2 }

  - do:
      get:
          index:  test
          type:   doc
          id:     1
  - match: { _source.foo: [baz] }
  - match: { _source.i:   [2] }
  - match: { _source.f:   [1.2000000476837158] }
  - match: { _source.d:   ["2018-01-01T12:33:55.000Z"] }

  - do:
      update:
          index:   test
          type:    doc
          id:      1
          refresh: true
          body:
            doc:
                foo: bort
                i:   [3, 2]
                f:   [0.1, -1]
  - match: { _index:   test }
  - match: { _type:    doc }
  - match: { _id:      "1" }
  - match: { _version: 3 }

  - do:
      get:
          index:  test
          type:   doc
          id:     1
  - match: { _source.foo: [bort] }
  - match: { _source.i:   [2, 3] }
  - match: { _source.f:   [-1.0, 0.10000000149011612] }
  - match: { _source.d:   ["2018-01-01T12:33:55.000Z"] }
